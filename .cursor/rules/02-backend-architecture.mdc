---
description: 
globs: 
alwaysApply: false
---
# Backend Architecture

The backend of LocalCA is built with Go and follows a modular architecture. The system is composed of several key packages that work together to provide certificate management functionality.

## Main Application

The main entry point is [main.go](mdc:main.go), which:
- Initializes the configuration and storage
- Creates the CA certificate if it doesn't exist
- Sets up HTTP and HTTPS servers
- Configures API routes
- Starts the ACME server

## Core Packages

### Certificate Management

The [pkg/certificates](mdc:pkg/certificates) package handles all certificate operations:

- **CA Management**: Creating and managing the root CA in [ca.go](mdc:pkg/certificates/ca.go)
- **Server Certificates**: Generation of server-side TLS certificates in [server.go](mdc:pkg/certificates/server.go)
- **Client Certificates**: Generation of client authentication certificates in [client.go](mdc:pkg/certificates/client.go)
- **Certificate Revocation**: Maintains the Certificate Revocation List in [crl.go](mdc:pkg/certificates/crl.go)

### Storage

The [pkg/storage](mdc:pkg/storage) package provides persistent storage for certificates and metadata:

- File-based storage for all certificates
- Methods for retrieving, storing, and managing certificate files
- Path management for CA, server, and client certificates

### Configuration

The [pkg/config](mdc:pkg/config) package handles application configuration:

- Loading configuration from environment variables
- Default configuration values
- Validation of configuration parameters

### API Handlers

The [pkg/handlers](mdc:pkg/handlers) package implements the HTTP API endpoints:

- Certificate creation, renewal, and revocation endpoints
- Authentication and authorization
- Web UI serving

### ACME Protocol

The [pkg/acme](mdc:pkg/acme) package implements the ACME protocol for automated certificate issuance:

- ACME server implementation
- Challenge verification
- Integration with certificate service

### Email Notifications

The [pkg/email](mdc:pkg/email) package handles certificate expiration notifications:

- SMTP configuration
- Email templates
- Scheduled notifications for expiring certificates

## API Endpoints

The API routes are defined in the [app/api](mdc:app/api) directory:
- `/api/ca-info`: CA information endpoints
- `/api/certificates`: Certificate management endpoints
- `/api/delete`: Certificate deletion endpoints
- `/api/renew`: Certificate renewal endpoints
- `/api/revoke`: Certificate revocation endpoints
